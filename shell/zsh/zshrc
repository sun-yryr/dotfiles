# ~/.zshrc file for zsh interactive shells.

# ------------------------------------------------------------
# 起動時間をミリ秒単位で計測する
# ------------------------------------------------------------
START_TIME=$(date +%s%N)

# dotfilesディレクトリのパスを設定（zprofileで設定済みだが、念のため）
export DOTFILES_DIR="${DOTFILES_DIR:-$HOME/Documents/dotfiles}"

# ------------------------------------------------------------
# rc.d配下の設定を数字順に読み込み
# ------------------------------------------------------------
for config_file in "$DOTFILES_DIR/shell/zsh/rc.d"/*.zsh; do
  if [ -f "$config_file" ]; then
    source "$config_file"
  fi
done

# ------------------------------------------------------------
# OSごとのエイリアス設定の読み込み
# ------------------------------------------------------------
if [[ "$OSTYPE" == "darwin"* ]]; then
  # macOS
  if [ -f "$DOTFILES_DIR/shell/zsh/rc.d/os/10_macos.zsh" ]; then
    source "$DOTFILES_DIR/shell/zsh/rc.d/os/10_macos.zsh"
  fi
elif [[ "$OSTYPE" == "linux-gnu"* ]]; then
  # Linux
  if [ -f /etc/os-release ]; then
    . /etc/os-release
    if [[ "$ID" == "ubuntu" ]]; then
      # Ubuntu
      if [ -f "$DOTFILES_DIR/shell/zsh/rc.d/os/10_ubuntu.zsh" ]; then
        source "$DOTFILES_DIR/shell/zsh/rc.d/os/10_ubuntu.zsh"
      fi
    fi
  fi
fi

# ------------------------------------------------------------
# ホスト名ベースの設定の読み込み
# ------------------------------------------------------------
HOST_CONFIG="$DOTFILES_DIR/shell/zsh/hosts/$(hostname).zsh"
if [ -f "$HOST_CONFIG" ]; then
  source "$HOST_CONFIG"
fi

# ------------------------------------------------------------
# ローカル設定の読み込み
# ------------------------------------------------------------
if [ -f "$HOME/.zshrc.local" ]; then
  source "$HOME/.zshrc.local"
fi

# ------------------------------------------------------------
# その他
# ------------------------------------------------------------
export GPG_TTY=$(tty)

# ------------------------------------------------------------
# 起動時間の計測（ミリ秒）
# ------------------------------------------------------------
END_TIME=$(date +%s%N)
ELAPSED_TIME=$(echo "scale=2; ($END_TIME - $START_TIME) / 1000000" | bc)
echo "起動時間: ${ELAPSED_TIME}ms"

# ------------------------------------------------------------
# Starshipの起動（必ず最後に実行する）
# ------------------------------------------------------------
eval "$(starship init zsh)"
